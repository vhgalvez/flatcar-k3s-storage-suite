---
# playbooks\03_cleanup_default_sa.yml
- name: ğŸ§¹ 3ï¸âƒ£ Eliminar ServiceAccount 'default' (namespace default)
  hosts: masters
  become: true
  gather_facts: false

  vars:
    ansible_python_interpreter: /bin/false  # âœ… Compatibilidad con Flatcar

  tasks:
    - name: ğŸ” Verificar si k3s estÃ¡ disponible
      raw: |
        command -v k3s && k3s kubectl version --client
      register: k3s_check
      failed_when: k3s_check.rc != 0

    - name: ğŸ§¹ Eliminar ServiceAccount 'default' si existe
      raw: |
        k3s kubectl delete serviceaccount default --ignore-not-found=true --namespace default
      register: sa_delete

    - name: ğŸ“¦ Resultado de la eliminaciÃ³n del SA 'default'
      debug:
        var: sa_delete.stdout_lines
